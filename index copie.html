<!DOCTYPE html>
<html lang="en" dir="ltr">
	<head>
		<meta charset="utf-8">
		<title>Groups Creator</title>

		<style>
			#groups {
				border: 5px solid red;
				display: flex;
				flex-direction: row;
			}

			.groupDiv {
				flex: 1;
				display: flex;
				flex-direction: column;
				border: 2px solid blue;
			}

			.titleDiv {
				flex: 1;
				background-color: yellow;
				border-bottom: 1px dashed black;
			}

			.nameDiv {
				flex: 2;
				border: 2px solid red;
			}
		</style>
	</head>
	<body>
		<h1>Groups Creator</h1>
		<p>
			<input id="name" type="text" placeholder="Enter name" />
			<button id="addNameToList">Add</button>
		</p>

		<p>
			Number of groups: <input type="number" value="2" min=1 /><br />
			<button id="createGroups">Create groups</button>
		</p>

		<div id="groups">
		</div>

		<script type="text/javascript">
			let listOfNames = [];

			listOfNames = localStorage.getItem("names").split(",")
			console.log(listOfNames)

			/*
			Create list
			*/
			function addNameToList() {
				const input = document.querySelector("#name");
				const name = input.value;

				if (name === "") {
					alert("No empty name");
					return;
				}
				listOfNames.push(name)
				input.value = "";

				localStorage.setItem("names", listOfNames.join(","))
				console.log(listOfNames);
			}
			document.querySelector("#addNameToList").addEventListener("click", addNameToList);
			document.querySelector("#name").addEventListener("keypress", (e) =>Â {
				if (e.keyCode === 13) {
					addNameToList()
				}
			});

			/*
			Create Groups
			*/
			document.querySelector("#createGroups").addEventListener("click", () => {
				const nbOfGroups = document.querySelector("input[type=number]").value;
				const divGroups = document.querySelector("#groups");
				const groups = createNGroups(listOfNames, nbOfGroups);

				if (nbOfGroups > listOfNames.length) {
					alert("Wrong number of groups");
					return;
				}

				divGroups.innerHTML = "";
				for (let i = 0; i < groups.length; i++) {
					divGroups.appendChild(createGroupDiv(groups[i], i + 1))
				}
			});

			function createGroupDiv(group, i) {
				let div = document.createElement("div");
				div.classList.add("groupDiv");

				let titleDiv = document.createElement("div");
				titleDiv.classList.add("titleDiv");
				titleDiv.innerText = `Groupe ${i}`

				let namesDiv = document.createElement("div");
				namesDiv.classList.add("namesDiv");
				group.forEach(name => {
					let nameDiv = document.createElement("div");
					nameDiv.addEventListener("click", (e) => {
						// console.log(this);
						// dans une fonction normale this === e.target
						e.target.parentNode.removeChild(e.target);
						const value = e.target.innerText;
						listOfNames = listOfNames.filter(element => element !== value)
					});
					nameDiv.innerText = name;
					namesDiv.appendChild(nameDiv)
				})

				div.appendChild(titleDiv)
				div.appendChild(namesDiv)
				return div;
			}

			const shuffle = (arr) => [...arr].sort(() => Math.random() - 0.5);

			function createNGroups(arr, n) {
				const names = shuffle(arr);
				const personPerGroup = Math.floor(names.length / n);
				let rest = names.length % n;

				let groups = [];

				console.log(personPerGroup)

				while (n > 0) {
					let personsToAddToGroup = personPerGroup;
					if (rest > 0) {
						personsToAddToGroup++;
						rest--;
					}
					groups.push(names.splice(0, personsToAddToGroup))
					n--;
				}
				return groups;
			}
		</script>
	</body>
</html>
